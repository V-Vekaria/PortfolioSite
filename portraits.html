<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portraits – Vishnu Vekaria</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<body>
  <!-- ===== Header / Navbar ===== -->
  <header class="site-header">
    <div class="container nav">
      <div class="brand">Vishnu Vekaria</div>

      <!-- Desktop menu -->
      <nav>
        <ul class="desktop">
          <li><a href="index.html">Home</a></li>
          <li><a href="portraits.html" class="active">Portraits</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>

      <!-- Hamburger button -->
      <button class="hamburger" aria-label="Menu"><span></span></button>
    </div>

    <!-- Mobile panel -->
    <div class="mobile" id="mobileMenu">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="portraits.html" class="active">Portraits</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </div>
  </header>

  <!-- ===== Main content ===== -->
  <main class="container section">
    <h1>Portraits</h1>
    <div id="gallery" class="grid portraits"></div>
  </main>

  <!-- ===== Lightbox ===== -->
  <div class="lightbox" id="lightbox">
    <span class="close">&times;</span>
    <span class="prev">&#10094;</span>
    <img class="lightbox-img" src="" alt="">
    <span class="next">&#10095;</span>
  </div>

  <!-- ===== Footer ===== -->
  <footer>
    <div class="container footer-inner">
      <p>© <span id="year"></span> Vishnu Vekaria — All Rights Reserved</p>
      <div class="social">
        <a href="https://www.instagram.com/vishnu.vekariya/" target="_blank" aria-label="Instagram">
          <i class="bi bi-instagram"></i>
        </a>
        <a href="https://www.linkedin.com/in/vishnu-vekaria-y" target="_blank" aria-label="LinkedIn">
          <i class="bi bi-linkedin"></i>
        </a>
      </div>
    </div>
  </footer>

  <!-- ===== Scripts ===== -->
  <script type="module">
    // ===== Load gallery from portraits.json =====
    async function loadGallery(){
      try {
        const res = await fetch("portraits.json?ts=" + Date.now());
        const data = await res.json();
        renderGallery(data);
      } catch(err){
        document.getElementById("gallery").innerHTML =
          "<p class='muted'>Could not load portraits.</p>";
      }
    }

    function renderGallery(items){
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = "";

      for (const p of items){
        const fig = document.createElement("figure");

        fig.innerHTML = `
          <img 
            src="${p.preview}" 
            data-full="${p.file}" 
            alt="" 
            class="lazy-blur" 
            loading="lazy">
        `;
        gallery.appendChild(fig);
      }

      // Trigger lightbox
      setupLightbox();

      // Start blur-up swap
      initBlurUp();
    }

    function initBlurUp(){
      const imgs = document.querySelectorAll("img.lazy-blur");

      imgs.forEach(img => {
        const fullSrc = img.getAttribute("data-full");
        const fullImg = new Image();
        fullImg.src = fullSrc;

        fullImg.onload = () => {
          img.src = fullSrc;
          img.classList.add("loaded");
        };
      });
    }

    // ===== Lightbox with swipe =====
    function setupLightbox(){
      const images = document.querySelectorAll(".grid.portraits img");
      const lightbox = document.getElementById("lightbox");
      const lightboxImg = document.querySelector(".lightbox-img");
      const closeBtn = document.querySelector(".lightbox .close");
      const prevBtn = document.querySelector(".lightbox .prev");
      const nextBtn = document.querySelector(".lightbox .next");

      let currentIndex = 0;

      function openLightbox(index) {
        currentIndex = index;
        document.body.classList.add("lb-open");
        lightbox.classList.add("open");
        lightboxImg.src = images[index].src;
      }

      function closeLightbox() {
        lightbox.classList.remove("open");
        document.body.classList.remove("lb-open");
      }

      function showPrev() {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        openLightbox(currentIndex);
      }

      function showNext() {
        currentIndex = (currentIndex + 1) % images.length;
        openLightbox(currentIndex);
      }

      images.forEach((img, i) => {
        img.addEventListener("click", () => openLightbox(i));
      });

      closeBtn.addEventListener("click", closeLightbox);
      prevBtn.addEventListener("click", (e) => { e.stopPropagation(); showPrev(); });
      nextBtn.addEventListener("click", (e) => { e.stopPropagation(); showNext(); });

      lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) closeLightbox();
      });

      document.addEventListener("keydown", (e) => {
        if (lightbox.classList.contains("open")) {
          if (e.key === "ArrowLeft") showPrev();
          if (e.key === "ArrowRight") showNext();
          if (e.key === "Escape") closeLightbox();
        }
      });

      // === Swipe gestures ===
      let startX = 0, startY = 0;
      lightbox.addEventListener("touchstart", (e) => {
        startX = e.changedTouches[0].screenX;
        startY = e.changedTouches[0].screenY;
      });
      lightbox.addEventListener("touchend", (e) => {
        const endX = e.changedTouches[0].screenX;
        const endY = e.changedTouches[0].screenY;
        handleSwipe(endX, endY);
      });

      function handleSwipe(endX, endY) {
        const threshold = 50;
        const distX = endX - startX;
        const distY = endY - startY;

        if (Math.abs(distX) > Math.abs(distY)) {
          if (Math.abs(distX) > threshold) {
            distX > 0 ? showPrev() : showNext();
          }
        } else {
          if (distY > threshold) closeLightbox();
        }
      }
    }

    loadGallery();
  </script>

  <!-- ===== Mobile menu toggle ===== -->
  <script>
    const hamburger = document.querySelector(".hamburger");
    const mobileMenu = document.getElementById("mobileMenu");

    hamburger.addEventListener("click", () => {
      mobileMenu.classList.toggle("show");
      document.body.classList.toggle("nav-open");
    });

    document.querySelectorAll(".mobile a").forEach(link => {
      link.addEventListener("click", () => {
        mobileMenu.classList.remove("show");
        document.body.classList.remove("nav-open");
      });
    });
  </script>
</body>
</html>
